{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ICT-OFFICE\\\\CascadeProjects\\\\st-patricks-makokoba\\\\src\\\\contexts\\\\AuthContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(undefined);\n\n// Default users\nconst defaultUsers = [{\n  username: 'parishioner',\n  password: 'parish123',\n  userType: 'user'\n}, {\n  username: 'admin',\n  password: 'admin123',\n  userType: 'admin'\n}];\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(() => {\n    // Check if user is already logged in (from localStorage)\n    const savedUser = localStorage.getItem('currentUser');\n    return savedUser ? JSON.parse(savedUser) : null;\n  });\n  const login = async (identifier, password) => {\n    try {\n      // Try API login first\n      const response = await api.auth.login({\n        username: identifier,\n        // Can be username, email, or phone\n        password\n      });\n      if (response.success && response.data) {\n        var _userData$user, _userData$user2, _userData$user3, _userData$user4, _userData$user5, _userData$user6, _userData$user7, _userData$user8;\n        const userData = response.data;\n        const newUser = {\n          id: (_userData$user = userData.user) === null || _userData$user === void 0 ? void 0 : _userData$user.id,\n          username: ((_userData$user2 = userData.user) === null || _userData$user2 === void 0 ? void 0 : _userData$user2.username) || identifier,\n          email: (_userData$user3 = userData.user) === null || _userData$user3 === void 0 ? void 0 : _userData$user3.email,\n          phone: (_userData$user4 = userData.user) === null || _userData$user4 === void 0 ? void 0 : _userData$user4.phone,\n          firstName: (_userData$user5 = userData.user) === null || _userData$user5 === void 0 ? void 0 : _userData$user5.firstName,\n          lastName: (_userData$user6 = userData.user) === null || _userData$user6 === void 0 ? void 0 : _userData$user6.lastName,\n          userType: ((_userData$user7 = userData.user) === null || _userData$user7 === void 0 ? void 0 : _userData$user7.role) === 'admin' ? 'admin' : 'user',\n          role: (_userData$user8 = userData.user) === null || _userData$user8 === void 0 ? void 0 : _userData$user8.role\n        };\n        setUser(newUser);\n        localStorage.setItem('currentUser', JSON.stringify(newUser));\n        localStorage.setItem('authToken', userData.token);\n        return {\n          success: true,\n          userType: newUser.userType,\n          message: `Welcome ${newUser.userType === 'admin' ? 'Administrator' : 'Parishioner'}!`\n        };\n      }\n    } catch (error) {\n      console.log('API login failed, trying fallback authentication');\n    }\n\n    // Fallback to default users for development\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    const foundUser = defaultUsers.find(u => u.username === identifier && u.password === password);\n    if (foundUser) {\n      const newUser = {\n        username: foundUser.username,\n        userType: foundUser.userType\n      };\n      setUser(newUser);\n      localStorage.setItem('currentUser', JSON.stringify(newUser));\n      return {\n        success: true,\n        userType: foundUser.userType,\n        message: `Welcome ${foundUser.userType === 'admin' ? 'Administrator' : 'Parishioner'}!`\n      };\n    }\n    return {\n      success: false,\n      message: 'Invalid credentials. Please check your email/phone and password.'\n    };\n  };\n  const register = async data => {\n    try {\n      const response = await api.auth.register({\n        username: data.email,\n        // Use email as username\n        email: data.email,\n        password: data.password,\n        role: data.role\n      });\n      if (response.success) {\n        return {\n          success: true,\n          message: 'Registration successful! Please sign in with your credentials.'\n        };\n      } else {\n        return {\n          success: false,\n          message: response.message || 'Registration failed. Please try again.'\n        };\n      }\n    } catch (error) {\n      console.error('Registration error:', error);\n      return {\n        success: false,\n        message: 'Registration failed. Please check your internet connection and try again.'\n      };\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('currentUser');\n    localStorage.removeItem('authToken');\n  };\n  const value = {\n    user,\n    isAuthenticated: !!user,\n    login,\n    register,\n    logout\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"VHgtRYRTIQP9H2kWH4PeMgPaONc=\");\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n_s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","api","jsxDEV","_jsxDEV","AuthContext","undefined","defaultUsers","username","password","userType","AuthProvider","children","_s","user","setUser","savedUser","localStorage","getItem","JSON","parse","login","identifier","response","auth","success","data","_userData$user","_userData$user2","_userData$user3","_userData$user4","_userData$user5","_userData$user6","_userData$user7","_userData$user8","userData","newUser","id","email","phone","firstName","lastName","role","setItem","stringify","token","message","error","console","log","Promise","resolve","setTimeout","foundUser","find","u","register","logout","removeItem","value","isAuthenticated","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/ICT-OFFICE/CascadeProjects/st-patricks-makokoba/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, ReactNode } from 'react';\nimport api from '../services/api';\n\nexport type UserType = 'user' | 'admin' | null;\n\ninterface User {\n  id?: string;\n  username: string;\n  email?: string;\n  phone?: string;\n  firstName?: string;\n  lastName?: string;\n  userType: UserType;\n  role?: string;\n}\n\ninterface RegistrationData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  password: string;\n  dateOfBirth?: string | null;\n  address?: string | null;\n  emergencyContact?: string | null;\n  emergencyPhone?: string | null;\n  role: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAuthenticated: boolean;\n  login: (identifier: string, password: string) => Promise<{ success: boolean; userType?: UserType; message?: string }>;\n  register: (data: RegistrationData) => Promise<{ success: boolean; message?: string }>;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\n// Default users\nconst defaultUsers = [\n  { username: 'parishioner', password: 'parish123', userType: 'user' as UserType },\n  { username: 'admin', password: 'admin123', userType: 'admin' as UserType }\n];\n\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(() => {\n    // Check if user is already logged in (from localStorage)\n    const savedUser = localStorage.getItem('currentUser');\n    return savedUser ? JSON.parse(savedUser) : null;\n  });\n\n  const login = async (identifier: string, password: string): Promise<{ success: boolean; userType?: UserType; message?: string }> => {\n    try {\n      // Try API login first\n      const response = await api.auth.login({ \n        username: identifier, // Can be username, email, or phone\n        password \n      });\n\n      if (response.success && response.data) {\n        const userData = response.data;\n        const newUser: User = {\n          id: userData.user?.id,\n          username: userData.user?.username || identifier,\n          email: userData.user?.email,\n          phone: userData.user?.phone,\n          firstName: userData.user?.firstName,\n          lastName: userData.user?.lastName,\n          userType: userData.user?.role === 'admin' ? 'admin' : 'user',\n          role: userData.user?.role\n        };\n        \n        setUser(newUser);\n        localStorage.setItem('currentUser', JSON.stringify(newUser));\n        localStorage.setItem('authToken', userData.token);\n        \n        return {\n          success: true,\n          userType: newUser.userType,\n          message: `Welcome ${newUser.userType === 'admin' ? 'Administrator' : 'Parishioner'}!`\n        };\n      }\n    } catch (error) {\n      console.log('API login failed, trying fallback authentication');\n    }\n\n    // Fallback to default users for development\n    await new Promise(resolve => setTimeout(resolve, 1000));\n\n    const foundUser = defaultUsers.find(\n      u => u.username === identifier && u.password === password\n    );\n\n    if (foundUser) {\n      const newUser = {\n        username: foundUser.username,\n        userType: foundUser.userType\n      };\n      \n      setUser(newUser);\n      localStorage.setItem('currentUser', JSON.stringify(newUser));\n      \n      return {\n        success: true,\n        userType: foundUser.userType,\n        message: `Welcome ${foundUser.userType === 'admin' ? 'Administrator' : 'Parishioner'}!`\n      };\n    }\n\n    return {\n      success: false,\n      message: 'Invalid credentials. Please check your email/phone and password.'\n    };\n  };\n\n  const register = async (data: RegistrationData): Promise<{ success: boolean; message?: string }> => {\n    try {\n      const response = await api.auth.register({\n        username: data.email, // Use email as username\n        email: data.email,\n        password: data.password,\n        role: data.role\n      });\n\n      if (response.success) {\n        return {\n          success: true,\n          message: 'Registration successful! Please sign in with your credentials.'\n        };\n      } else {\n        return {\n          success: false,\n          message: response.message || 'Registration failed. Please try again.'\n        };\n      }\n    } catch (error) {\n      console.error('Registration error:', error);\n      return {\n        success: false,\n        message: 'Registration failed. Please check your internet connection and try again.'\n      };\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('currentUser');\n    localStorage.removeItem('authToken');\n  };\n\n  const value = {\n    user,\n    isAuthenticated: !!user,\n    login,\n    register,\n    logout\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}